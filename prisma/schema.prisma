datasource db {
  provider = "mongodb"
  url      = env("MONGODB_URI")
}

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["mongoDb"]
}

model User {
  id               String    @id @default(auto()) @map("_id") @db.ObjectId
  email            String    @unique
  password         String
  name             String?
  username         String    @unique
  bio              String?
  avatar           String?
  snippets         Snippet[]
  resetToken       String?
  resetTokenExpiry DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
}

model Snippet {
  id          String        @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  description String?
  code        String        @db.String
  language    String
  fileName    String?
  complexity  String?
  isPublic    Boolean       @default(true)
  views       Int           @default(0)
  slug        String        @unique
  authorId    String        @db.ObjectId
  author      User          @relation(fields: [authorId], references: [id])
  tags        SnippetTag[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
}

model Tag {
  id        String        @id @default(auto()) @map("_id") @db.ObjectId
  name      String        @unique
  slug      String        @unique
  snippets  SnippetTag[]
  createdAt DateTime      @default(now())
}

model SnippetTag {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  snippetId String   @db.ObjectId
  tagId     String   @db.ObjectId
  snippet   Snippet  @relation(fields: [snippetId], references: [id])
  tag       Tag      @relation(fields: [tagId], references: [id])
  createdAt DateTime @default(now())

  @@unique([snippetId, tagId])
}